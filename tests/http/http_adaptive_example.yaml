server:
  host: 0.0.0.0
  port: 18080
  log_level: drasi_server=info,drasi_core=warn
  max_connections: 1000
  shutdown_timeout_seconds: 30
sources:
- id: events-http
  source_type: http_adaptive
  auto_start: true
  properties:
    adaptive_enabled: true
    adaptive_min_batch_size: 10
    adaptive_window_secs: 5
    adaptive_min_wait_ms: 1
    host: 0.0.0.0
    adaptive_max_wait_ms: 100
    adaptive_max_batch_size: 1000
    port: 8081
queries:
- id: event-processing
  query: |
    MATCH
      (r:Room)
    RETURN
      elementId(r) AS RoomId,
      r.temperature, r.humidity, r.co2
  sources:
  - events-http
  auto_start: true
  properties: {}
reactions:
- id: webhook-adaptive
  reaction_type: http_adaptive
  queries:
  - event-processing
  auto_start: true
  properties:
    adaptive_max_wait_ms: 50
    adaptive_enabled: true
    adaptive_max_batch_size: 500
    batch_endpoints_enabled: true
    adaptive_min_batch_size: 5
    queries:
      event-processing:
        added:
          body: |
            {
              "id": "{{after.RoomId}}",
              "temperature": {{after.temperature}},
              "humidity": {{after.humidity}},
              "co2": {{after.co2}}
            }
          method: POST
          url: /events
        deleted:
          body: |
            {
              "id": "{{before.RoomId}}"
            }
          method: DELETE
          url: /events/{{before.RoomId}}
        updated:
          body: |
            {
              "id": "{{after.RoomId}}",
              "temperature": {{after.temperature}},
              "humidity": {{after.humidity}},
              "co2": {{after.co2}}
            }
          method: PUT
          url: /events/{{after.RoomId}}
    base_url: http://localhost:3000
    adaptive_min_wait_ms: 5
    adaptive_window_secs: 5
    timeout_ms: 10000
