# Copyright 2025 The Drasi Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http:#www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Drasi Server Docker Compose - Server Only
# Use this when you have your own database (BYO database)
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your database connection details
#   # Edit config/server.yaml with your configuration
#   docker compose -f docker-compose.server-only.yml up -d
#
# This compose file only runs the Drasi Server without PostgreSQL.
# Configure your external database connection via environment variables or config.

name: drasi-server-standalone

services:
  drasi-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: drasi-server:latest
    container_name: drasi-server
    ports:
      - "${DRASI_API_PORT:-8080}:8080"    # REST API
      - "${DRASI_SSE_PORT:-8081}:8081"    # SSE reactions (if configured)
    volumes:
      # Mount config directory for easy editing
      - ./config:/app/config:rw
    environment:
      - RUST_LOG=${LOG_LEVEL:-info}
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8080
    env_file:
      - path: .env
        required: false
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 15s
    restart: unless-stopped
