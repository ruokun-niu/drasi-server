server:
  host: 0.0.0.0
  port: 8080
  logLevel: drasi_server=info,drasi_core=warn
  disablePersistence: false
sources:
- kind: http
  id: facilities-db
  autoStart: true
  port: 9000
  host: 0.0.0.0
queries:
- id: all-rooms
  query: |
    MATCH
      (r:Room)
    RETURN
      elementId(r) AS RoomId,
      r.temperature, r.humidity, r.co2
  sources:
  - source_id: facilities-db
  auto_start: true
reactions:
- kind: http
  id: rooms-webhook
  queries:
  - all-rooms
  autoStart: true
  timeoutMs: 5000
  baseUrl: http://localhost:9001
  token: demo-token-12345
  queries:
    all-rooms:
      added:
        body: |
          {
            "event": "room-added",
            "room": {
              "id": "{{after.Id}}",
              "temp": "{{after.Temperature}}",
              "humidity": "{{after.Humidity}}",
              "occupancy": "{{after.Occupancy}}"
            }
          }
        headers:
          X-Building: '{{after.building_name}}'
          X-Event-Type: room-added
        method: POST
        url: /reaction
      deleted:
        body: |
          {
            "event": "room-deleted",
            "room": {
              "id": "{{before.Id}}",
              "temp": "{{before.Temperature}}",
              "humidity": "{{before.Humidity}}",
              "occupancy": "{{before.Occupancy}}"
            }
          }
        headers:
          X-Building: '{{before.building_name}}'
          X-Event-Type: room-deleted
        method: POST
        url: /reaction
      updated:
        body: |
          {
            "event": "room-updated",
            "room": {
              "id": "{{after.Id}}",
              "temp": "{{after.Temperature}}",
              "humidity": "{{after.Humidity}}",
              "occupancy": "{{after.Occupancy}}"
            }
          }
        headers:
          X-Building: '{{after.building_name}}'
          X-Event-Type: room-updated
        method: POST
        url: /reaction
