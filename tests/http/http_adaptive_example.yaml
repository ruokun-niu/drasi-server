server:
  host: 0.0.0.0
  port: 18080
  logLevel: drasi_server=info,drasi_core=warn
  disablePersistence: false
sources:
- kind: http
  id: events-http
  autoStart: true
  adaptiveEnabled: true
  adaptiveMinBatchSize: 10
  adaptiveWindowSecs: 5
  adaptiveMinWaitMs: 1
  host: 0.0.0.0
  adaptiveMaxWaitMs: 100
  adaptiveMaxBatchSize: 1000
  port: 8081
queries:
- id: event-processing
  query: |
    MATCH
      (r:Room)
    RETURN
      elementId(r) AS RoomId,
      r.temperature, r.humidity, r.co2
  sources:
  - source_id: events-http
  auto_start: true
reactions:
- kind: http-adaptive
  id: webhook-adaptive
  queries:
  - event-processing
  autoStart: true
  adaptiveMaxWaitMs: 50
  adaptiveEnabled: true
  adaptiveMaxBatchSize: 500
  batchEndpointsEnabled: true
  adaptiveMinBatchSize: 5
  queries:
    event-processing:
      added:
        body: |
          {
            "id": "{{after.RoomId}}",
            "temperature": {{after.temperature}},
            "humidity": {{after.humidity}},
            "co2": {{after.co2}}
          }
        method: POST
        url: /events
      deleted:
        body: |
          {
            "id": "{{before.RoomId}}"
          }
        method: DELETE
        url: /events/{{before.RoomId}}
      updated:
        body: |
          {
            "id": "{{after.RoomId}}",
            "temperature": {{after.temperature}},
            "humidity": {{after.humidity}},
            "co2": {{after.co2}}
          }
        method: PUT
        url: /events/{{after.RoomId}}
  baseUrl: http://localhost:3000
  adaptiveMinWaitMs: 5
  adaptiveWindowSecs: 5
  timeoutMs: 10000
